<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">


<ui:composition template="/templates/common.xhtml">
	<ui:define name="pageTitle">Citas</ui:define>
	<ui:define name="pageHeader">Consulta de citas</ui:define>
	<ui:define name="head">
		<script type="text/javascript">
		    function handleScheduleValidation(xhr, status, args) {
		     	var isValid = args.isValid;
		     	if(!isValid)
		     		cal.update();
		    }
		</script>
	</ui:define>
	<ui:define name="dialogs">
		<p:dialog id="diag" widgetVar="citaDiag" appendToBody="true"
			closable="true" modal="true" position="center"
			showEffect="clip" hideEffect="clip" dynamic="true"
			header="Detalles de la cita">
			<h:form id="frmDiag" prependId="false">
				<p:panelGrid columns="2">
					<p:outputLabel id="lblPatient" value="Paciente"/>
					<h:outputText value="#{citaQuery.selectedCita.paciente.name} #{citaQuery.selectedCita.paciente.lastName} #{citaQuery.selectedCita.paciente.maternalLastName}" />
					<p:outputLabel id="lblStudy" value="Estudio"/>
					<h:outputText value="#{citaQuery.selectedCita.tipoestudiocita.name}" />
					<p:outputLabel id="lblTelephone" value="Telefono"/>
					<h:outputText value="#{citaQuery.selectedCita.paciente.phoneNumber}" />
					<p:outputLabel id="lblStatus" value="Status"/>
					<p:selectOneMenu id="cmbStatus" value="#{citaQuery.selectedCita.statuscita}" converter="#{statusCitaConverter}">
						<f:selectItems value="#{statusCitaQuery.queryListDM}" var="_status"
							itemLabel="#{_status.description}" itemValue="#{_status}"></f:selectItems>
					</p:selectOneMenu>
					<f:facet name="footer">
						<p:commandButton id="btnSave" value="Cambiar Status" actionListener="#{citaQuery.onStatusChanged}"
							oncomplete="cal.update();citaDiag.hide();"/>
					</f:facet>
				</p:panelGrid>
			</h:form>
		</p:dialog>
	</ui:define>

	<ui:define name="body">
		
		<h:form id="frmCalendar" prependId="false">
			<p:outputLabel id="lblDateSearch" value="Ir a fecha: " />
			<p:calendar id="cldDateSearch" value="#{citaQuery.initialDate}"
				mode="popup">
				<p:ajax event="dateSelect" update="shlCal" />
			</p:calendar>

			<p:spacer height="30" />

			<p:schedule id="shlCal" value="#{citaQuery.model}" allDaySlot="false"
				slotMinutes="10" view="agendaDay" draggable="true" resizable="false"
				locale="es" widgetVar="cal" initialDate="#{citaQuery.initialDate}" 
				minTime="8:00" maxTime="17:00">
				<p:ajax event="eventSelect" listener="#{citaQuery.onEventSelect}"
					update=":diag" oncomplete="citaDiag.show()"/>
				<p:ajax event="eventMove" listener="#{citaQuery.onEventMove}"
					oncomplete="handleScheduleValidation(xhr, status, args)"/>
			</p:schedule>
		</h:form>

	</ui:define>
	
	
</ui:composition>

</html>
